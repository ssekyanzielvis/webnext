(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[984],{723:function(e,s,n){Promise.resolve().then(n.bind(n,7578))},7578:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return c}});var t=n(7437),i=n(2265),a=n(9376),r=n(149);function c(){var e;let s=(0,r.e)(),n=(0,a.useParams)(),c=(0,a.useRouter)(),[l,d]=(0,i.useState)(null),[o,u]=(0,i.useState)("user"),[m,x]=(0,i.useState)(!0),[p,h]=(0,i.useState)(null),[f,g]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{var e,t;x(!0),h(null);let{data:{user:i}}=await s.auth.getUser();if(!i){c.push("/auth/login");return}u((null===(e=i.app_metadata)||void 0===e?void 0:e.role)||(null===(t=i.user_metadata)||void 0===t?void 0:t.role)||"user");let{data:a,error:r}=await s.from("consignments").select("*").eq("id",n.id).single();r&&h(r.message),d(a),x(!1)})()},[n.id]);let j=async e=>{if(!l)return;let{error:n}=await s.from("consignments").update({status:e}).eq("id",l.id);if(n){h(n.message);return}d({...l,status:e})},v=async()=>{if(!l||!f)return;let{error:e}=await s.from("consignments").update({driver_id:f,status:"assigned"}).eq("id",l.id);if(e){h(e.message);return}d({...l,driver_id:f,status:"assigned"}),g("")};if(m)return(0,t.jsx)("main",{className:"max-w-3xl mx-auto p-4",children:"Loadingâ€¦"});if(p)return(0,t.jsx)("main",{className:"max-w-3xl mx-auto p-4 text-red-600",children:p});if(!l)return(0,t.jsx)("main",{className:"max-w-3xl mx-auto p-4",children:"Not found"});let N="driver"===o,b="admin"===o||"other_admin"===o;return(0,t.jsxs)("main",{className:"max-w-3xl mx-auto p-4 space-y-4",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold",children:["Consignment #",l.id.slice(0,8)]}),(0,t.jsxs)("div",{className:"card p-4 space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Pickup:"})," ",l.pickup_location]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Delivery:"})," ",l.delivery_location]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Item:"})," ",l.item_description]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Weight:"})," ",l.weight," kg"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Status:"})," ",(0,t.jsx)("span",{className:"px-2 py-0.5 rounded bg-gray-100 text-gray-800 text-xs",children:l.status})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Driver:"})," ",null!==(e=l.driver_id)&&void 0!==e?e:"Unassigned"]}),l.special_instructions&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Notes:"})," ",l.special_instructions]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Created ",new Date(l.created_at).toLocaleString()]})]}),(N||b)&&(0,t.jsxs)("section",{className:"card p-4 space-y-3",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Actions"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:()=>j("picked_up"),children:"Mark Picked Up"}),(0,t.jsx)("button",{className:"px-3 py-2 bg-indigo-600 text-white rounded",onClick:()=>j("in_transit"),children:"Mark In Transit"}),(0,t.jsx)("button",{className:"px-3 py-2 bg-green-600 text-white rounded",onClick:()=>j("delivered"),children:"Mark Delivered"})]}),b&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"px-3 py-2 bg-gray-700 text-white rounded",onClick:()=>j("pending"),children:"Set Pending"}),(0,t.jsx)("button",{className:"px-3 py-2 bg-orange-600 text-white rounded",onClick:()=>j("assigned"),children:"Set Assigned"}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm",children:"Assign driver:"}),(0,t.jsx)("input",{value:f,onChange:e=>g(e.target.value),placeholder:"driver uuid",className:"input"}),(0,t.jsx)("button",{className:"px-3 py-2 bg-blue-600 text-white rounded",onClick:v,children:"Assign"})]})]})]})]}),(0,t.jsx)("section",{children:(0,t.jsx)("a",{className:"text-blue-600 hover:underline",href:"/consignments/".concat(l.id,"/documents"),children:"Manage Documents"})})]})}},149:function(e,s,n){"use strict";n.d(s,{e:function(){return a}});var t=n(1388);let i=null;function a(){if(i)return i;let e="https://awjryaofcfuhyofqfixo.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3anJ5YW9mY2Z1aHlvZnFmaXhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzA5MjYsImV4cCI6MjA3MzAwNjkyNn0.3ccRaiv7odT4xL6jI0f5dV9BrMnZw8LUeofJZ0ZOo5c";if(!e||!s)throw Error("Missing Supabase envs");return i=(0,t.createBrowserClient)(e,s,{cookies:{getAll:async()=>"undefined"==typeof document?[]:document.cookie.split(";").map(e=>e.trim()).filter(Boolean).map(e=>{let s=e.indexOf("=");return{name:s>=0?decodeURIComponent(e.slice(0,s)):e,value:s>=0?decodeURIComponent(e.slice(s+1)):""}}),setAll:async e=>(function(e){if("undefined"!=typeof document)for(let{name:s,value:n,options:t}of e){let e="".concat(encodeURIComponent(s),"=").concat(encodeURIComponent(n));t&&(t.maxAge&&(e+="; Max-Age=".concat(t.maxAge)),t.expires&&(e+="; Expires=".concat(new Date(t.expires).toUTCString())),t.path&&(e+="; Path=".concat(t.path)),t.domain&&(e+="; Domain=".concat(t.domain)),t.sameSite&&(e+="; SameSite=".concat(t.sameSite)),t.secure&&(e+="; Secure")),document.cookie=e}})(e)}})}},9376:function(e,s,n){"use strict";var t=n(5475);n.o(t,"useParams")&&n.d(s,{useParams:function(){return t.useParams}}),n.o(t,"useRouter")&&n.d(s,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[1388,2971,2117,1744],function(){return e(e.s=723)}),_N_E=e.O()}]);