(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1786],{3167:function(e,t,a){Promise.resolve().then(a.bind(a,3811))},3811:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return r}});var n=a(7437),c=a(2265),i=a(149),o=a(7795);function r(e){let{params:t}=e,a=(0,i.e)(),r=t.id,[l,u]=(0,c.useState)([]),[d,m]=(0,c.useState)(""),[f,p]=(0,c.useState)(null),h=(0,c.useRef)(null);async function g(){let{data:{user:e}}=await a.auth.getUser();if(!e||!f)return;let t=d.trim();t&&(m(""),await a.from("messages").insert({chat_room_id:r,sender_id:e.id,receiver_id:f,message:t,type:"text",created_at:new Date().toISOString()}))}async function x(){let{data:{user:e}}=await a.auth.getUser();if(!e||!f)return;let t=await s();if(!t)return;let n=await (0,o.D)({bucket:"chat-images",file:t,path:"".concat(r,"/").concat(e.id,"_").concat(Date.now(),"_").concat(t.name)});n&&await a.from("messages").insert({chat_room_id:r,sender_id:e.id,receiver_id:f,image_url:n.publicUrl,type:"image",created_at:new Date().toISOString()})}return(0,c.useEffect)(()=>{(async()=>{let{data:{user:e}}=await a.auth.getUser();if(!e){window.location.href="/auth/login";return}let{data:t}=await a.from("chat_rooms").select("*").eq("id",r).maybeSingle();t&&p(t.user1_id===e.id?t.user2_id:t.user1_id);let{data:n}=await a.from("messages").select("*").eq("chat_room_id",r).order("created_at",{ascending:!0});u(n||[]);let c=a.channel("messages:".concat(r)).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:"chat_room_id=eq.".concat(r)},e=>{u(t=>[...t,e.new])}).subscribe();return()=>{a.removeChannel(c)}})()},[r,a]),(0,c.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[l]),(0,n.jsx)("main",{className:"max-w-2xl mx-auto px-4 py-6",children:(0,n.jsxs)("div",{className:"card p-4 h-[70vh] flex flex-col",children:[(0,n.jsxs)("div",{className:"flex-1 overflow-auto space-y-2",children:[l.map(e=>(0,n.jsx)("div",{className:"max-w-[75%] px-3 py-2 rounded-md ".concat("image"===e.type?"bg-neutral-100":e.message?"bg-neutral-100":"bg-neutral-50"," ").concat(e.sender_id===f?"":"ml-auto bg-[#E9EDFF]"),children:e.message},e.id)),(0,n.jsx)("div",{ref:h})]}),(0,n.jsxs)("div",{className:"mt-2 flex gap-2",children:[(0,n.jsx)("input",{className:"flex-1 border rounded-md px-3 py-2",value:d,onChange:e=>m(e.target.value),placeholder:"Type a message"}),(0,n.jsx)("button",{className:"px-3 py-2 rounded-md bg-neutral-100",onClick:x,children:"Image"}),(0,n.jsx)("button",{className:"btn-primary",onClick:g,children:"Send"})]})]})})}async function s(){return new Promise(e=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=()=>{var a;e((null===(a=t.files)||void 0===a?void 0:a[0])||null)},t.click()})}},7795:function(e,t,a){"use strict";a.d(t,{D:function(){return c}});var n=a(149);async function c(e){let t=(0,n.e)(),{bucket:a,file:c}=e,i=e.path||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2),"_").concat(c.name),{error:o}=await t.storage.from(a).upload(i,c);if(o)return null;let{data:r}=t.storage.from(a).getPublicUrl(i);return{publicUrl:r.publicUrl,path:i}}},149:function(e,t,a){"use strict";a.d(t,{e:function(){return i}});var n=a(1388);let c=null;function i(){if(c)return c;let e="https://awjryaofcfuhyofqfixo.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3anJ5YW9mY2Z1aHlvZnFmaXhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzA5MjYsImV4cCI6MjA3MzAwNjkyNn0.3ccRaiv7odT4xL6jI0f5dV9BrMnZw8LUeofJZ0ZOo5c";if(!e||!t)throw Error("Missing Supabase envs");return c=(0,n.createBrowserClient)(e,t,{cookies:{getAll:async()=>"undefined"==typeof document?[]:document.cookie.split(";").map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.indexOf("=");return{name:t>=0?decodeURIComponent(e.slice(0,t)):e,value:t>=0?decodeURIComponent(e.slice(t+1)):""}}),setAll:async e=>(function(e){if("undefined"!=typeof document)for(let{name:t,value:a,options:n}of e){let e="".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(a));n&&(n.maxAge&&(e+="; Max-Age=".concat(n.maxAge)),n.expires&&(e+="; Expires=".concat(new Date(n.expires).toUTCString())),n.path&&(e+="; Path=".concat(n.path)),n.domain&&(e+="; Domain=".concat(n.domain)),n.sameSite&&(e+="; SameSite=".concat(n.sameSite)),n.secure&&(e+="; Secure")),document.cookie=e}})(e)}})}}},function(e){e.O(0,[1388,2971,2117,1744],function(){return e(e.s=3167)}),_N_E=e.O()}]);