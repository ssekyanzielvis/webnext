(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8826],{4664:function(e,t,n){Promise.resolve().then(n.bind(n,9457))},9457:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return r}});var a=n(7437),i=n(2265),s=n(149),c=n(9376);function r(){let e=(0,s.e)(),t=(0,c.useRouter)(),[n,r]=(0,i.useState)(null),[o,u]=(0,i.useState)(""),[l,m]=(0,i.useState)([]),[d,f]=(0,i.useState)(!1),h=(0,i.useMemo)(()=>o.trim().toLowerCase(),[o]);(0,i.useEffect)(()=>{(async()=>{let{data:{user:n}}=await e.auth.getUser();if(!n){t.push("/auth/login");return}r(n.id)})()},[]),(0,i.useEffect)(()=>{let t=!0;return(async()=>{if(!h){m([]);return}f(!0);let{data:n,error:a}=await e.from("users").select("id, email, full_name").ilike("email","%".concat(h,"%")).limit(20);if(f(!1),t){if(a){m([]);return}m(n)}})(),()=>{t=!1}},[h,e]);let p=async a=>{if(n)try{let{data:i,error:s}=await e.rpc("get_or_create_chat_room",{u1:n,u2:a});if(s)throw s;t.push("/chat/".concat(i))}catch(c){let{data:i,error:s}=await e.from("chat_rooms").upsert({user1_id:n<a?n:a,user2_id:n<a?a:n},{onConflict:"user1_id,user2_id"}).select("id").single();if(s||!i)return;t.push("/chat/".concat(i.id))}};return(0,a.jsxs)("main",{className:"max-w-2xl mx-auto p-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-3",children:"Start a new conversation"}),(0,a.jsx)("input",{className:"input w-full",placeholder:"Search by email",value:o,onChange:e=>u(e.target.value)}),d&&(0,a.jsx)("div",{className:"mt-2 text-sm",children:"Searchingâ€¦"}),(0,a.jsxs)("ul",{className:"mt-4 divide-y border rounded",children:[l.map(e=>(0,a.jsxs)("li",{className:"p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.full_name||e.email||e.id}),(0,a.jsx)("div",{className:"text-xs text-gray-600",children:e.email})]}),(0,a.jsx)("button",{className:"px-3 py-1.5 bg-blue-600 text-white rounded",onClick:()=>p(e.id),children:"Chat"})]},e.id)),!l.length&&!!h&&!d&&(0,a.jsx)("li",{className:"p-3 text-sm text-gray-600",children:"No users found"})]})]})}},149:function(e,t,n){"use strict";n.d(t,{e:function(){return s}});var a=n(1388);let i=null;function s(){if(i)return i;let e="https://awjryaofcfuhyofqfixo.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3anJ5YW9mY2Z1aHlvZnFmaXhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzA5MjYsImV4cCI6MjA3MzAwNjkyNn0.3ccRaiv7odT4xL6jI0f5dV9BrMnZw8LUeofJZ0ZOo5c";if(!e||!t)throw Error("Missing Supabase envs");return i=(0,a.createBrowserClient)(e,t,{cookies:{getAll:async()=>"undefined"==typeof document?[]:document.cookie.split(";").map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.indexOf("=");return{name:t>=0?decodeURIComponent(e.slice(0,t)):e,value:t>=0?decodeURIComponent(e.slice(t+1)):""}}),setAll:async e=>(function(e){if("undefined"!=typeof document)for(let{name:t,value:n,options:a}of e){let e="".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n));a&&(a.maxAge&&(e+="; Max-Age=".concat(a.maxAge)),a.expires&&(e+="; Expires=".concat(new Date(a.expires).toUTCString())),a.path&&(e+="; Path=".concat(a.path)),a.domain&&(e+="; Domain=".concat(a.domain)),a.sameSite&&(e+="; SameSite=".concat(a.sameSite)),a.secure&&(e+="; Secure")),document.cookie=e}})(e)}})}},9376:function(e,t,n){"use strict";var a=n(5475);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[1388,2971,2117,1744],function(){return e(e.s=4664)}),_N_E=e.O()}]);