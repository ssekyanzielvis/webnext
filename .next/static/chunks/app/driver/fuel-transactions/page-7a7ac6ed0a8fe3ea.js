(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8004],{1272:function(e,t,n){Promise.resolve().then(n.bind(n,5992))},5992:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return o}});var a=n(7437),i=n(2265),c=n(149),r=n(7795);function o(){let e=(0,c.e)(),[t,n]=(0,i.useState)([]),[o,l]=(0,i.useState)(!0),[u,d]=(0,i.useState)(null),m=(0,i.useCallback)(async()=>{l(!0);let{data:{user:t}}=await e.auth.getUser();if(!t){window.location.href="/auth/login";return}let{data:a,error:i}=await e.from("fuel_transactions").select("*").eq("driver_id",t.id).order("transaction_date",{ascending:!1});i?d(i.message):n(a),l(!1)},[e]);async function f(){let{data:{user:t}}=await e.auth.getUser();if(!t)return;let n=prompt("Station?")||"Station",a=Number(prompt("Amount?")||"0"),i=Number(prompt("Quantity?")||"0"),c=await s(),o=null;if(c){let e=await (0,r.D)({bucket:"fuel-receipts",file:c,path:"".concat(t.id,"/receipt_").concat(Date.now(),"_").concat(c.name)});e&&(o=e.publicUrl)}let{error:l}=await e.from("fuel_transactions").insert({id:crypto.randomUUID(),driver_id:t.id,fuel_card_id:null,type:"fuel",amount:a,quantity:i,price_per_unit:a/(i||1),station:n,location:"N/A",transaction_date:new Date().toISOString(),receipt_url:o});l?d(l.message):m()}return(0,i.useEffect)(()=>{m()},[m]),(0,a.jsxs)("main",{className:"max-w-4xl mx-auto px-4 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:"Fuel Transactions"}),(0,a.jsx)("button",{className:"btn-primary",onClick:f,children:"Add"})]}),u&&(0,a.jsx)("div",{className:"text-sm text-red-600 mb-3",children:u}),o?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsx)("ul",{className:"space-y-3",children:t.map(e=>(0,a.jsxs)("li",{className:"card p-4",children:[(0,a.jsxs)("div",{className:"font-semibold",children:[e.station," • ",e.type]}),(0,a.jsxs)("div",{className:"text-sm text-neutral-600",children:["Amount: ",e.amount," • Qty: ",e.quantity]}),(0,a.jsx)("div",{className:"text-xs text-neutral-500",children:new Date(e.transaction_date).toLocaleString()}),e.receipt_url&&(0,a.jsx)("a",{className:"text-sm text-blue-600",href:e.receipt_url,target:"_blank",children:"View receipt"})]},e.id))})]})}async function s(){return new Promise(e=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=()=>{var n;e((null===(n=t.files)||void 0===n?void 0:n[0])||null)},t.click()})}},7795:function(e,t,n){"use strict";n.d(t,{D:function(){return i}});var a=n(149);async function i(e){let t=(0,a.e)(),{bucket:n,file:i}=e,c=e.path||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2),"_").concat(i.name),{error:r}=await t.storage.from(n).upload(c,i);if(r)return null;let{data:o}=t.storage.from(n).getPublicUrl(c);return{publicUrl:o.publicUrl,path:c}}},149:function(e,t,n){"use strict";n.d(t,{e:function(){return c}});var a=n(1388);let i=null;function c(){if(i)return i;let e="https://awjryaofcfuhyofqfixo.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3anJ5YW9mY2Z1aHlvZnFmaXhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzA5MjYsImV4cCI6MjA3MzAwNjkyNn0.3ccRaiv7odT4xL6jI0f5dV9BrMnZw8LUeofJZ0ZOo5c";if(!e||!t)throw Error("Missing Supabase envs");return i=(0,a.createBrowserClient)(e,t,{cookies:{getAll:async()=>"undefined"==typeof document?[]:document.cookie.split(";").map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.indexOf("=");return{name:t>=0?decodeURIComponent(e.slice(0,t)):e,value:t>=0?decodeURIComponent(e.slice(t+1)):""}}),setAll:async e=>(function(e){if("undefined"!=typeof document)for(let{name:t,value:n,options:a}of e){let e="".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n));a&&(a.maxAge&&(e+="; Max-Age=".concat(a.maxAge)),a.expires&&(e+="; Expires=".concat(new Date(a.expires).toUTCString())),a.path&&(e+="; Path=".concat(a.path)),a.domain&&(e+="; Domain=".concat(a.domain)),a.sameSite&&(e+="; SameSite=".concat(a.sameSite)),a.secure&&(e+="; Secure")),document.cookie=e}})(e)}})}}},function(e){e.O(0,[1388,2971,2117,1744],function(){return e(e.s=1272)}),_N_E=e.O()}]);