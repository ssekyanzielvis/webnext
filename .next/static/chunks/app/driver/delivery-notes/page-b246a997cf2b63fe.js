(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5005],{1144:function(e,t,a){Promise.resolve().then(a.bind(a,2650))},2650:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var n=a(7437),i=a(2265),c=a(3145),r=a(149),s=a(7795);function o(){let e=(0,r.e)(),[t,a]=(0,i.useState)([]),[o,d]=(0,i.useState)(!0),[u,m]=(0,i.useState)(null),f=(0,i.useCallback)(async()=>{d(!0);let{data:{user:t}}=await e.auth.getUser();if(!t){window.location.href="/auth/login";return}let{data:n,error:i}=await e.from("delivery_notes").select("*").eq("driver_id",t.id).order("created_at",{ascending:!1});i?m(i.message):a(n),d(!1)},[e]);async function p(){let{data:{user:t}}=await e.auth.getUser();if(!t)return;let a=prompt("Customer name?")||"",n=prompt("Delivery address?")||"",i=await l();if(!i)return;let c=await (0,s.D)({bucket:"delivery-notes",file:i,path:"delivery_notes/".concat(t.id,"_").concat(Date.now(),".jpg")});if(!c){m("Upload failed");return}let{error:r}=await e.from("delivery_notes").insert({id:crypto.randomUUID(),driver_id:t.id,customer_id:t.id,customer_name:a,delivery_address:n,image_url:c.publicUrl,image_path:c.path,status:"delivered",created_at:new Date().toISOString()});r?m(r.message):f()}return(0,i.useEffect)(()=>{f()},[f]),(0,n.jsxs)("main",{className:"max-w-4xl mx-auto px-4 py-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsx)("h1",{className:"text-xl font-bold",children:"Delivery Notes"}),(0,n.jsx)("button",{className:"btn-primary",onClick:p,children:"Add Note"})]}),u&&(0,n.jsx)("div",{className:"text-sm text-red-600 mb-3",children:u}),o?(0,n.jsx)("div",{children:"Loading..."}):(0,n.jsx)("ul",{className:"space-y-3",children:t.map(e=>(0,n.jsxs)("li",{className:"card p-4 flex gap-3",children:[(0,n.jsx)("div",{className:"relative w-24 h-24",children:(0,n.jsx)(c.default,{src:e.image_url,alt:"proof",fill:!0,className:"object-cover rounded",sizes:"96px"})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("div",{className:"font-semibold",children:e.customer_name}),(0,n.jsx)("div",{className:"text-sm text-neutral-600",children:e.delivery_address}),(0,n.jsx)("div",{className:"text-xs text-neutral-500",children:new Date(e.created_at).toLocaleString()})]})]},e.id))})]})}async function l(){return new Promise(e=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=()=>{var a;e((null===(a=t.files)||void 0===a?void 0:a[0])||null)},t.click()})}},7795:function(e,t,a){"use strict";a.d(t,{D:function(){return i}});var n=a(149);async function i(e){let t=(0,n.e)(),{bucket:a,file:i}=e,c=e.path||"".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2),"_").concat(i.name),{error:r}=await t.storage.from(a).upload(c,i);if(r)return null;let{data:s}=t.storage.from(a).getPublicUrl(c);return{publicUrl:s.publicUrl,path:c}}},149:function(e,t,a){"use strict";a.d(t,{e:function(){return c}});var n=a(1388);let i=null;function c(){if(i)return i;let e="https://awjryaofcfuhyofqfixo.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3anJ5YW9mY2Z1aHlvZnFmaXhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MzA5MjYsImV4cCI6MjA3MzAwNjkyNn0.3ccRaiv7odT4xL6jI0f5dV9BrMnZw8LUeofJZ0ZOo5c";if(!e||!t)throw Error("Missing Supabase envs");return i=(0,n.createBrowserClient)(e,t,{cookies:{getAll:async()=>"undefined"==typeof document?[]:document.cookie.split(";").map(e=>e.trim()).filter(Boolean).map(e=>{let t=e.indexOf("=");return{name:t>=0?decodeURIComponent(e.slice(0,t)):e,value:t>=0?decodeURIComponent(e.slice(t+1)):""}}),setAll:async e=>(function(e){if("undefined"!=typeof document)for(let{name:t,value:a,options:n}of e){let e="".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(a));n&&(n.maxAge&&(e+="; Max-Age=".concat(n.maxAge)),n.expires&&(e+="; Expires=".concat(new Date(n.expires).toUTCString())),n.path&&(e+="; Path=".concat(n.path)),n.domain&&(e+="; Domain=".concat(n.domain)),n.sameSite&&(e+="; SameSite=".concat(n.sameSite)),n.secure&&(e+="; Secure")),document.cookie=e}})(e)}})}}},function(e){e.O(0,[1388,3145,2971,2117,1744],function(){return e(e.s=1144)}),_N_E=e.O()}]);